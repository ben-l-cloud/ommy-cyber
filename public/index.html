<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ben Whittaker Tech Bot - Pairing</title>
<style>
  * { margin:0; padding:0; box-sizing: border-box; }
  body, html {
    height: 100%; width: 100%; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: url("/cyber.png") no-repeat center center/cover;
    color: white;
    text-shadow: 1px 1px 6px #000;
  }
  .overlay {
    background: rgba(0,0,0,0.65);
    height: 100%; width: 100%;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 20px;
    gap: 12px;
  }
  h1 { font-weight: 700; font-size: 2.8rem; margin-bottom: 10px; }
  h3 { font-weight: 600; font-size: 1.4rem; }
  input[type="text"] {
    padding: 14px 16px;
    font-size: 1.2rem;
    border-radius: 8px;
    border: none;
    width: 320px;
    max-width: 90vw;
  }
  button {
    padding: 12px 24px;
    font-size: 1.15rem;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: background-color 0.25s ease;
    color: white;
    min-width: 140px;
  }
  #btnPairCode {
    background-color: #28a745;
  }
  #btnPairCode:hover {
    background-color: #1e7e34;
  }
  #btnQRScan {
    background-color: #007bff;
  }
  #btnQRScan:hover {
    background-color: #0056b3;
  }
  #langToggle {
    background-color: transparent;
    border: 1.5px solid white;
    color: white;
    font-size: 0.9rem;
    padding: 6px 12px;
    border-radius: 20px;
    position: absolute;
    top: 20px;
    right: 20px;
    cursor: pointer;
  }
  #result, #qrCodeContainer {
    margin-top: 24px;
    background: rgba(255,255,255,0.15);
    padding: 18px 20px;
    border-radius: 12px;
    max-width: 400px;
    word-break: break-word;
    text-align: center;
    font-size: 1.1rem;
  }
  #qrCodeContainer img {
    max-width: 300px;
    margin: auto;
    display: block;
  }
</style>
</head>
<body>

<button id="langToggle">SW</button>

<div class="overlay">
  <h1 id="title">🤖 Ben Whittaker Tech Bot</h1>
  <h3 id="instruction">Enter WhatsApp Number to Connect</h3>
  <input type="text" id="phoneNumber" placeholder="Example: 255760xxxxxxx" required />
  <div>
    <button id="btnPairCode">Show Pair Code</button>
    <button id="btnQRScan">Show QR Scan</button>
  </div>
  <div id="result"></div>
  <div id="qrCodeContainer"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  const btnPairCode = document.getElementById("btnPairCode");
  const btnQRScan = document.getElementById("btnQRScan");
  const phoneNumberInput = document.getElementById("phoneNumber");
  const resultDiv = document.getElementById("result");
  const qrCodeContainer = document.getElementById("qrCodeContainer");
  const langToggle = document.getElementById("langToggle");

  const text = {
    en: {
      title: "🤖 Ben Whittaker Tech Bot",
      instruction: "Enter WhatsApp Number to Connect",
      placeholder: "Example: 255760xxxxxxx",
      pairCodeBtn: "Show Pair Code",
      qrScanBtn: "Show QR Scan",
      invalidNumber: "⚠️ Please enter a valid number (9-15 digits).",
      waiting: "⌛ Please wait...",
      scanPrompt: "Please scan the QR code below with your WhatsApp:",
      connected: "✅ WhatsApp connected successfully!",
      error: "❌ Error: ",
      alreadyPaired: "You are already connected.",
    },
    sw: {
      title: "🤖 Ben Whittaker Tech Bot",
      instruction: "Weka Namba ya WhatsApp Kuunganishwa",
      placeholder: "Mfano: 255760xxxxxxx",
      pairCodeBtn: "Onyesha Pair Code",
      qrScanBtn: "Onyesha QR Scan",
      invalidNumber: "⚠️ Tafadhali ingiza namba halali (tarakimu 9-15).",
      waiting: "⌛ Tafadhali subiri...",
      scanPrompt: "Tafadhali scan QR code hapo chini kwenye WhatsApp yako:",
      connected: "✅ WhatsApp imeunganishwa kwa mafanikio!",
      error: "❌ Hitilafu: ",
      alreadyPaired: "Umeunganishwa tayari.",
    }
  };

  let currentLang = "en";

  function updateLanguage() {
    const t = text[currentLang];
    document.getElementById("title").innerText = t.title;
    document.getElementById("instruction").innerText = t.instruction;
    phoneNumberInput.placeholder = t.placeholder;
    btnPairCode.innerText = t.pairCodeBtn;
    btnQRScan.innerText = t.qrScanBtn;
    resultDiv.innerText = "";
    qrCodeContainer.innerHTML = "";
    langToggle.innerText = currentLang === "en" ? "SW" : "EN";
  }

  langToggle.addEventListener("click", () => {
    currentLang = currentLang === "en" ? "sw" : "en";
    updateLanguage();
  });

  updateLanguage();

  function clearOutputs() {
    resultDiv.innerHTML = "";
    qrCodeContainer.innerHTML = "";
  }

  function validNumber(num) {
    return /^\d{9,15}$/.test(num);
  }

  btnPairCode.addEventListener("click", () => {
    clearOutputs();
    const number = phoneNumberInput.value.trim();
    if (!validNumber(number)) {
      resultDiv.innerText = text[currentLang].invalidNumber;
      return;
    }
    resultDiv.innerText = text[currentLang].waiting;
    socket.emit("startPairing", number);
  });

  btnQRScan.addEventListener("click", () => {
    clearOutputs();
    const number = phoneNumberInput.value.trim();
    if (!validNumber(number)) {
      resultDiv.innerText = text[currentLang].invalidNumber;
      return;
    }
    resultDiv.innerText = text[currentLang].waiting;
    socket.emit("startPairing", number);
  });

  socket.on("qr", (qrDataUrl) => {
    resultDiv.innerText = text[currentLang].scanPrompt;
    qrCodeContainer.innerHTML = `<img src="${qrDataUrl}" alt="QR Code" />`;
  });

  socket.on("pairingStatus", (msg) => {
    resultDiv.innerText = msg;
    if (msg.includes("✅") || msg.includes("imeunganishwa")) {
      qrCodeContainer.innerHTML = "";
    }
  });

  socket.on("pairingError", (errMsg) => {
    resultDiv.innerText = text[currentLang].error + errMsg;
    qrCodeContainer.innerHTML = "";
  });

</script>
</body>
</html>
